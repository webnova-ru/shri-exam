/*!
 * CanJS - 1.1.8
 * http://canjs.us/
 * Copyright (c) 2013 Bitovi
 * Tue, 24 Sep 2013 21:59:56 GMT
 * Licensed MIT
 * Includes: can/util/fixture
 * Download from: http://canjs.com
 */

!function(t){var e=function(e){return"undefined"!=typeof steal?t.isFunction(steal.config)?steal.config().root.mapJoin(e).toString():steal.root.join(e).toString():(t.fixture.rootUrl||"")+e},n=function(n,o){if(t.fixture.on){var a=function(){"undefined"!=typeof steal&&steal.dev&&steal.dev.log("fixture INFO: "+Array.prototype.slice.call(arguments).join(" "))};n.type=n.type||n.method||"GET";var i=u(n);if(!n.fixture)return"file:"===window.location.protocol&&a("ajax request to "+n.url+", no fixture found"),void 0;if("string"==typeof n.fixture&&t.fixture[n.fixture]&&(n.fixture=t.fixture[n.fixture]),"string"==typeof n.fixture){var s=n.fixture;/^\/\//.test(s)&&(s=e(n.fixture.substr(2))),i&&(s=t.sub(s,i)),delete n.fixture,n.url=s,n.data=null,n.type="GET",n.error||(n.error=function(t,e,n){throw"fixtures.js Error "+e+" "+n})}else n.dataTypes&&n.dataTypes.splice(0,0,"fixture"),i&&o&&t.extend(o.data,i)}},o=function(t,e,n,o){return"number"!=typeof t&&(o=e,n=t,e="success",t=200),"string"!=typeof e&&(o=n,n=e,e="success"),t>=400&&599>=t&&(this.dataType="text"),[t,e,a(this,n),o]},a=function(t,e){var n=t.dataTypes?t.dataTypes[0]:t.dataType||"json";if(!e||!e[n]){var o={};o[n]=e,e=o}return e};if(t.ajaxPrefilter&&t.ajaxTransport)t.ajaxPrefilter(n),t.ajaxTransport("fixture",function(e,n){e.dataTypes.shift();var i,s=!1;return{send:function(r,u){i=setTimeout(function(){var t=function(){s===!1&&u.apply(null,o.apply(e,arguments))},i=e.fixture(n,t,r,e);void 0!==i&&u(200,"success",a(e,i),{})},t.fixture.delay)},abort:function(){s=!0,clearTimeout(i)}}});else{var i=t.ajax;t.ajax=function(e){if(n(e,e),e.fixture){var a,s=new t.Deferred,r=!1;return s.getResponseHeader=function(){},s.then(e.success,e.fail),s.abort=function(){clearTimeout(a),r=!0,s.reject(s)},a=setTimeout(function(){var t=function(){var t=o.apply(e,arguments),n=t[0];(n>=200&&300>n||304===n)&&r===!1?s.resolve(t[2][e.dataType]):s.reject(s,"error",t[1])},n=e.fixture(e,t,e.headers,e);void 0!==n&&s.resolve(n)},t.fixture.delay),s}return i(e)}}var s=[],r=function(t,e){for(var n=0;n<s.length;n++)if(d._similar(t,s[n],e))return n;return-1},u=function(t){var e=r(t);return e>-1?(t.fixture=s[e].fixture,d._getData(s[e].url,t.url)):void 0},l=function(t){var e=t.data.id;return void 0===e&&"number"==typeof t.data&&(e=t.data),void 0===e&&t.url.replace(/\/(\d+)(\/|$|\.)/g,function(t,n){e=n}),void 0===e&&(e=t.url.replace(/\/(\w+)(\/|$|\.)/g,function(t,n){"update"!=n&&(e=n)})),void 0===e&&(e=Math.round(1e3*Math.random())),e},d=t.fixture=function(e,n){if(void 0!==n){if("string"==typeof e){var o=e.match(/(GET|POST|PUT|DELETE) (.+)/i);e=o?{url:o[2],type:o[1]}:{url:e}}var a=r(e,!!n);if(a>-1&&s.splice(a,1),null==n)return;e.fixture=n,s.push(e)}else t.each(e,function(t,e){d(e,t)})},c=t.replacer;return t.extend(t.fixture,{_similar:function(e,n,o){return o?t.Object.same(e,n,{fixture:null}):t.Object.subset(e,n,t.fixture._compare)},_compare:{url:function(t,e){return!!d._getData(e,t)},fixture:null,type:"i"},_getData:function(e,n){var o=[],a=e.replace(".","\\.").replace("?","\\?"),i=new RegExp(a.replace(c,function(t,e){return o.push(e),"([^/]+)"})+"$").exec(n),s={};return i?(i.shift(),t.each(o,function(t){s[t]=i.shift()}),s):null},store:function(e,n,o,a){var i=[],s=0,r=function(t){for(var e=0;e<i.length;e++)if(t==i[e].id)return i[e]},u={};"string"==typeof e?e=[e+"s",e]:t.isArray(e)||(a=o,o=n,n=e),t.extend(u,{findAll:function(e){e=e||{};var n=i.slice(0);e.data=e.data||{},t.each((e.data.order||[]).slice(0).reverse(),function(t){var e=t.split(" ");n=n.sort(function(t,n){return"ASC"!==e[1].toUpperCase()?t[e[0]]<n[e[0]]?1:t[e[0]]==n[e[0]]?0:-1:t[e[0]]<n[e[0]]?-1:t[e[0]]==n[e[0]]?0:1})}),t.each((e.data.group||[]).slice(0).reverse(),function(t){var e=t.split(" ");n=n.sort(function(t,n){return t[e[0]]>n[e[0]]})});var o=parseInt(e.data.offset,10)||0,s=parseInt(e.data.limit,10)||i.length-o,r=0;for(var u in e.data)if(r=0,void 0!==e.data[u]&&(-1!=u.indexOf("Id")||-1!=u.indexOf("_id")))for(;r<n.length;)e.data[u]!=n[r][u]?n.splice(r,1):r++;if(a)for(r=0;r<n.length;)a(n[r],e)?r++:n.splice(r,1);return{count:n.length,limit:e.data.limit,offset:e.data.offset,data:n.slice(o,o+s)}},findOne:function(t,e){var n=r(l(t));e(n?n:void 0)},update:function(e,n){var o=l(e);t.extend(r(o),e.data),n({id:l(e)},{location:e.url||"/"+l(e)})},destroy:function(e){for(var n=l(e),o=0;o<i.length;o++)if(i[o].id==n){i.splice(o,1);break}return t.extend(r(n)||{},e.data),{}},create:function(e,n){var a=o(i.length,i);t.extend(a,e.data),a.id||(a.id=s++),i.push(a),n({id:a.id},{location:e.url+"/"+a.id})}});var d=function(){i=[];for(var a=0;n>a;a++){var r=o(a,i);r.id||(r.id=a),s=Math.max(r.id+1,s+1)||i.length,i.push(r)}t.isArray(e)&&(t.fixture["~"+e[0]]=i,t.fixture["-"+e[0]]=u.findAll,t.fixture["-"+e[1]]=u.findOne,t.fixture["-"+e[1]+"Update"]=u.update,t.fixture["-"+e[1]+"Destroy"]=u.destroy,t.fixture["-"+e[1]+"Create"]=u.create)};return d(),t.extend({getId:l,find:function(t){return r(l(t))},reset:d},u)},rand:function(t,e,n){if("number"==typeof t)return"number"==typeof e?t+Math.floor(Math.random()*(e-t)):Math.floor(Math.random()*t);var o=arguments.callee;if(void 0===e)return o(t,o(t.length+1));var a=[];t=t.slice(0),n||(n=e),n=e+Math.round(o(n-e));for(var i=0;n>i;i++)a.push(t.splice(o(t.length),1)[0]);return a},xhr:function(e){return t.extend({},{abort:t.noop,getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},open:t.noop,overrideMimeType:t.noop,readyState:4,responseText:"",responseXML:null,send:t.noop,setRequestHeader:t.noop,status:200,statusText:"OK"},e)},on:!0}),t.fixture.delay=200,t.fixture.rootUrl=e(""),t.fixture["-handleFunction"]=function(e){return"string"==typeof e.fixture&&t.fixture[e.fixture]&&(e.fixture=t.fixture[e.fixture]),"function"==typeof e.fixture?(setTimeout(function(){e.success&&e.success.apply(null,e.fixture(e,"success")),e.complete&&e.complete.apply(null,e.fixture(e,"complete"))},t.fixture.delay),!0):!1},t.fixture.overwrites=s,t.fixture.make=t.fixture.store,t.fixture}(can);